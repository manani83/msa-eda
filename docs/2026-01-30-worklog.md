# 2026-01-30 Worklog

## 1) .gitignore 정리
- Spring Boot + Gradle 기준으로 `.gitignore` 생성 및 정리.
- `logs/` 추가, IDE 항목을 단일 섹션으로 통합.
- `application-*.yml` 제외 규칙은 적용하지 않음.

## 2) 쿠폰 도메인 분리 및 주문 생성 쿠폰 적용
- 쿠폰 도메인 패키지 추가: `domain/coupon`.
- 쿠폰 조회 포트 추가: `application/coupon/port/out/CouponQueryPort`.
- 주문 생성 시 쿠폰 적용하도록 흐름 연결.
- 주문 도메인에 쿠폰 코드/할인 금액 필드 추가.
- 주문 생성 요청/커맨드에 `couponCode` 추가.

## 3) 쿠폰 DB 조회 전환 + 쿠폰 조건/만료 적용
- 인메모리 쿠폰 어댑터 제거.
- JPA 기반 쿠폰 조회 어댑터 추가:
  - `CouponEntity`, `CouponJpaRepository`, `CouponPersistenceAdapter`.
- 쿠폰 도메인에 최소주문금액/유효기간 필드 추가 및 검증 로직 적용.
- 주문 저장/복원 시 쿠폰 정보(쿠폰코드/할인금액) 영속화.

## 4) 응답 확장 및 예외 처리 추가
- 주문 생성 응답에 `couponCode`, `discountAmount` 포함.
- 쿠폰 예외 추가: `CouponNotFoundException`, `CouponValidationException`.
- 전역 예외 처리기 및 에러 응답 모델 추가:
  - `GlobalExceptionHandler`, `ErrorResponse`.

## 5) 샘플 데이터 및 테스트 보강
- `data.sql` 추가: `WELCOME10`, `SAVE1000`, `EXPIRED10` 쿠폰 삽입.
- `application.yml`에 `spring.jpa.defer-datasource-initialization: true` 추가.
- 주문 통합 테스트에 쿠폰 적용/실패 케이스 추가.
- 주문 컨트롤러 테스트에 쿠폰 오류 응답 검증 추가.

## 6) 테스트 실행 결과
- `./gradlew test` 실행.
- 최초 실패 원인: `data.sql` 실행 시 `coupons` 테이블 미생성 -> `defer-datasource-initialization` 추가로 해결.
- 이후 `OrderControllerTest` JSON 문자열 이스케이프 문제 수정.
- 마지막 테스트 재실행은 사용자 중단으로 종료됨(완료 여부 미확인).
